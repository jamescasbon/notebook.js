(function(){var h,k,g,i,j,a;g="undefined"!==typeof exports&&null!==exports?exports:this;g=g.NotebookJS=null!=(k=g.NotebookJS)?k:{};g.util=null!=(a=g.util)?a:{};h=jQuery;i=function(c){var a,f,l,e,m,n,g,h;if("undefined"!==typeof atob&&null!==atob)return atob(c);a=g=0;h=[];if(!c)return c;for(c+="";g<c.length;)l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(g++)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(g++)),m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(g++)),
n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(g++)),f=l<<18|e<<12|m<<6|n,l=f>>16&255,e=f>>8&255,f&=255,64===m?h[a++]=String.fromCharCode(l):64===n?h[a++]=String.fromCharCode(l,e):h[a++]=String.fromCharCode(l,e,f);return h.join("")};j=function(c){var a,f,l,e,m,n,g;if("undefined"!==typeof btoa&&null!==btoa)return btoa(c);a=n=0;g=[];if(!c)return c;for(c+="";n<c.length;)l=c.charCodeAt(n++),e=c.charCodeAt(n++),m=c.charCodeAt(n++),f=l<<16|e<<8|m,l=f>>18&63,e=f>>
12&63,m=f>>6&63,f&=63,g[a++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f);a=g.join("");c=c.length%3;return(c?a.slice(0,c-3):a)+"===".slice(c||3)};k=function(){function c(c){var a=this;this.element=h('<div class="modal">\n  <div class="modal-inner">\n    <a class="close">&times;</a>\n    <div class="modal-content"></div>\n  </div>\n</div>');
this.element.appendTo(document.body);this.element.on("click",".close",function(){return a.close()});c&&this.setContent(c)}c.prototype.setContent=function(c){return this.element.find(".modal-content").html(c)};c.prototype.close=function(){return this.element.remove()};return c}();g.util.base64Encode=j;g.util.base64Decode=i;g.util.base64UrlEncode=function(c){for(c=j(c);"="===c.slice(-1);)c=c.slice(0,-1);c=c.replace(/\+/g,"-");return c=c.replace(/\//g,"_")};g.util.base64UrlDecode=function(c){var a,f;
f=c.length%4;if(0!==f){a=0;for(f=4-f;0<=f?a<f:a>f;0<=f?a++:a--)c+="="}c=c.replace(/-/g,"+");c=c.replace(/_/g,"/");return i(c)};g.util.ModalDialog=k}).call(this);(function(){var h,k,g,i,j,a,c=function(c,a){return function(){return c.apply(a,arguments)}},q=Object.prototype.hasOwnProperty,f=function(c,a){function m(){this.constructor=c}for(var f in a)q.call(a,f)&&(c[f]=a[f]);m.prototype=a.prototype;c.prototype=new m;c.__super__=a.prototype;return c};j="undefined"!==typeof exports&&null!==exports?exports:this;i=j.NotebookJS=null!=(a=j.NotebookJS)?a:{};g=function(a){function e(){this.serialize=c(this.serialize,this);this.readyCells=c(this.readyCells,this);this.initialize=
c(this.initialize,this);this.defaults=c(this.defaults,this);e.__super__.constructor.apply(this,arguments)}f(e,a);e.prototype.defaults=function(){return{title:"untitled"}};e.prototype.initialize=function(){};e.prototype.readyCells=function(){this.cells=new k;return this.cells.localStorage=new Store("cells-"+this.get("id"))};e.prototype.serialize=function(){var a;a=this.toJSON();a.cells=this.cells.toJSON();return JSON.stringify(a)};return e}(Backbone.Model);j=function(a){function c(){c.__super__.constructor.apply(this,
arguments)}f(c,a);c.prototype.model=g;c.prototype.localStorage=new Store("notebook.js");return c}(Backbone.Collection);h=function(a){function e(){this.handleMessage=c(this.handleMessage,this);this.evaluateError=c(this.evaluateError,this);this.evaluateSuccess=c(this.evaluateSuccess,this);this.interrupt=c(this.interrupt,this);this.evaluate=c(this.evaluate,this);this.toggleInputFold=c(this.toggleInputFold,this);this.toggleType=c(this.toggleType,this);this.defaults=c(this.defaults,this);e.__super__.constructor.apply(this,
arguments)}f(e,a);e.prototype.tagName="li";e.prototype.defaults=function(){return{input:"",type:"javascript",inputFold:!1,output:null,position:null,error:null,state:null}};e.prototype.toggleType=function(){"javascript"===this.get("type")?this.set({type:"markdown"}):this.set({type:"javascript"});return this.set({state:"dirty"})};e.prototype.toggleInputFold=function(){this.set({inputFold:!this.get("inputFold")});return this.save()};e.prototype.evaluate=function(){this.set({output:null,error:null});
this.set({state:"evaluating"});this.save();this.handler=i.engines[this.get("type")];return this.handler.evaluate(this.get("input"),this)};e.prototype.interrupt=function(){if(null!=this.handler)return this.onPrint("Interrupted","error"),this.handler.interrupt(),this.set({state:null}),this.save()};e.prototype.evaluateSuccess=function(a){this.set({output:a,error:null});return this.save()};e.prototype.evaluateError=function(a){this.set({error:a});return this.save};e.prototype.handleMessage=function(a){switch(a.msg){case "evalEnd":return this.set({state:null}),
this.save();case "error":return this.onPrint(a.data,"error");case "print":return this.onPrint(a.data,"print");case "result":return this.onPrint(a.data,"print");case "raw":return this.onPrint(a.data,"raw")}};e.prototype.onError=function(a){return this.set({error:a})};e.prototype.onPrint=function(a,c){return this.set({output:(this.get("output")||"").concat('<div class="'+c+'">'+a+"</div>")})};return e}(Backbone.Model);k=function(a){function e(){this.comparator=c(this.comparator,this);e.__super__.constructor.apply(this,
arguments)}f(e,a);e.prototype.model=h;e.prototype.posJump=Math.pow(2,16);e.prototype.comparator=function(a,c){a=a.get("position");c=c.get("position");return a>c?1:a<c?-1:0};e.prototype.createAtEnd=function(){return this.create({position:this.length?this.at(this.length-1).get("position")+this.posJump:this.posJump})};e.prototype.createBefore=function(a){var c;c=this.indexOf(a);a=a.get("position");c=0===c?0:this.at(c-1).get("position");return this.create({position:(a+c)/2})};return e}(Backbone.Collection);
i.Notebook=g;i.Notebooks=j;i.Cell=h;i.Cells=k}).call(this);(function(){var h,k,g,i,j=function(a,c){return function(){return a.apply(c,arguments)}};k="undefined"!==typeof exports&&null!==exports?exports:this;k=k.NotebookJS=null!=(h=k.NotebookJS)?h:{};(function(){function a(){this.evaluate=j(this.evaluate,this)}a.prototype.evaluate=function(a,g){var f;try{if(f=eval(a),null!=f)return console.log("result",f),g.handleMessage({msg:"result",data:f.toString()})}catch(h){return console.log(h.message,h.stack),g.handleMessage({msg:"error",data:h.toString()})}finally{g.handleMessage({msg:"evalEnd"})}};
return a})();h=function(){function a(){this.evaluate=j(this.evaluate,this)}a.prototype.evaluate=function(a,g){var f,h;try{return h=new Showdown.converter,f=h.makeHtml(a),g.handleMessage({msg:"raw",data:f})}catch(e){return console.log(e.message),onErr(e.message)}finally{g.handleMessage({msg:"evalEnd"})}};return a}();g=function(){function a(){this.interrupt=j(this.interrupt,this);this.handleMessage=j(this.handleMessage,this);this.evaluate=j(this.evaluate,this);this.worker=new Worker("/src/worker.js");
this.worker.onmessage=this.handleMessage;this.inputId=0;this.handlers={}}a.prototype.evaluate=function(a,g){this.inputId+=1;this.handlers[this.inputId]=g;return this.worker.postMessage({src:a,id:this.inputId})};a.prototype.handleMessage=function(a){return this.handlers[a.data.inputId].handleMessage(a.data)};a.prototype.interrupt=function(){this.worker.terminate();this.worker=new Worker("/src/worker.js");return this.worker.onmessage=this.handleMessage};return a}();i={};i.javascript=new g;i.markdown=
new h;k.engines=i}).call(this);(function(){var h,k,g,i,j,a,c,q,f,l,e,m,n,r,s,d=function(a,b){return function(){return a.apply(b,arguments)}},t=Object.prototype.hasOwnProperty,p=function(a,b){function o(){this.constructor=a}for(var c in b)t.call(b,c)&&(a[c]=b[c]);o.prototype=b.prototype;a.prototype=new o;a.__super__=b.prototype;return a};_.templateSettings={interpolate:/\[\[=(.+?)\]\]/g,evaluate:/\[\[(.+?)\]\]/g};h="undefined"!==typeof exports&&null!==exports?exports:this;a=h.NotebookJS=null!=(s=h.NotebookJS)?s:{};f=function(a){var b,
o,c;o=$(window).scrollTop()+60;b=$(window).scrollTop()+$(window).height()-30;c=a.offset().top;return c+a.height()<=b&&c>=o};n=function(a){a=a.offset().top-90;console.log("stat",a);return $(window).scrollTop(a)};m=function(a){a=a.offset().top+a.height()+60-$(window).height();console.log("stab",a);return $("body").scrollTop(a)};h=function(c){function b(){this.generateToc=d(this.generateToc,this);this.typeset=d(this.typeset,this);this.share=d(this.share,this);this.saveToFile=d(this.saveToFile,this);
this.mathjaxReady=d(this.mathjaxReady,this);this.handleTocJump=d(this.handleTocJump,this);b.__super__.constructor.apply(this,arguments)}p(b,c);b.prototype.className="app";b.prototype.handleTocJump=function(a){window.e=a;if(a=$(a.target).attr("href"))return a=$("#"+a),n(a)};b.prototype.mathjaxReady=function(){return this.typeset()};b.prototype.saveToFile=function(a){var b;b=this.model.serialize();$(a.target).attr("download","notebook-"+(new Date).toISOString().slice(0,10)+".json");return $(a.target).attr("href",
"data:application/json;charset=utf-8,"+escape(b))};b.prototype.share=function(){var o,b;o=a.util.base64UrlEncode(this.model.serialize());b="http://"+location.host+"/#import/"+escape(o)+"/";o=_.template($("#share-notebook").html());return(new a.util.ModalDialog(o({url:b}))).element.find("input").focus().select()};b.prototype.typeset=function(){var a,b,c,d;prettyPrint();d=this.$("#notebook");b=0;for(c=d.length;b<c;b++)a=d[b],console.log("tp",a),MathJax.Hub.Typeset(a);return this.$("#toc").html(this.generateToc())};
b.prototype.generateToc=function(){var a;a=$(document.createElement("div"));this.$(".cell").each(function(b,c){var d;d=$(document.createElement("div")).appendTo(a);d.addClass("toc-cell");d.attr("href",$(c).attr("id"));return $(c).find("h1, h2, h3").each(function(c,d){var e,f;f="title"+b+"_"+c;$(d).attr("id",f);e=$(document.createElement("div"));e.addClass(d.tagName);e.addClass("toc-entry");e.attr("href",f);e.html($(d).html());return a.append(e)})});return a};return b}(Backbone.View);q=function(c){function b(){this.renderCell=
d(this.renderCell,this);this.addAll=d(this.addAll,this);this.addOne=d(this.addOne,this);this.render=d(this.render,this);this.initialize=d(this.initialize,this);this.toggleEdit=d(this.toggleEdit,this);b.__super__.constructor.apply(this,arguments)}p(b,c);b.prototype.events={"click #toc":"handleTocJump","click #toggle-edit":"toggleEdit","click #save-to-file":"saveToFile","click #share-url":"share","dblclick #notebook":"toggleEdit"};b.prototype.toggleEdit=function(){return a.router.navigate(this.model.get("id")+
"/edit/",{trigger:!0})};b.prototype.initialize=function(){this.template=_.template($("#notebook-template").html());this.cellTemplate=_.template($("#cell-view-template").html());$(".container").append(this.render());this.cells=this.$(".cells");console.log(this.cells);this.model.cells.fetch({success:this.addAll});if(a.mathjaxReady)return this.typeset()};b.prototype.render=function(){$(this.el).html(this.template());return this.el};b.prototype.addOne=function(a){return this.cells.append(this.renderCell(a))};
b.prototype.addAll=function(a){return a.each(this.addOne)};b.prototype.renderCell=function(a){a=a.toJSON();a.input=a.input.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return this.cellTemplate(a)};return b}(h);g=function(c){function b(){this.toggleEdit=d(this.toggleEdit,this);this.spawnKeypress=d(this.spawnKeypress,this);this.spawnCellAtEnd=d(this.spawnCellAtEnd,this);this.addAll=d(this.addAll,this);this.addOne=d(this.addOne,this);this.render=d(this.render,this);this.initialize=
d(this.initialize,this);this.events=d(this.events,this);b.__super__.constructor.apply(this,arguments)}p(b,c);b.prototype.events=function(){return{"click #toc":"handleTocJump","dblclick #spawner":"spawnCellAtEnd","keyup #spawner":"spawnKeypress","click #toggle-edit":"toggleEdit","click #save-to-file":"saveToFile","click #share-url":"share"}};b.prototype.initialize=function(){this.template=_.template($("#notebook-template").html());$(".container").append(this.render());this.cells=this.$(".cells");this.model.cells.bind("add",
this.addOne);this.model.cells.bind("refresh",this.addAll);this.model.cells.fetch({success:this.addAll});if(a.mathjaxReady)return console.log("calling typeset at init"),this.typeset()};b.prototype.render=function(){$(this.el).html(this.template());return this.el};b.prototype.addOne=function(b){var c,d;a.c=b;d=new k({model:b});c=d.render();b=this.model.cells.indexOf(b);0===b?this.cells.prepend(c):(b=this.model.cells.at(b-1),b=b.view,$(b.el).after(c));d.afterDomInsert();return d.focusInput()};b.prototype.addAll=
function(a){return a.each(this.addOne)};b.prototype.spawnCellAtEnd=function(){return this.model.cells.createAtEnd()};b.prototype.spawnKeypress=function(a){if(13===a.keyCode)return this.model.cells.createAtEnd();if(38===a.keyCode)return a=this.model.cells.length,this.model.cells.at(a-1).view.output.focus()};b.prototype.toggleEdit=function(){return a.router.navigate(this.model.get("id")+"/view/",{trigger:!0})};return b}(h);k=function(c){function b(){this.resizeEditor=d(this.resizeEditor,this);this.inputChange=
d(this.inputChange,this);this.toggle=d(this.toggle,this);this.spawnAbove=d(this.spawnAbove,this);this.remove=d(this.remove,this);this.interrupt=d(this.interrupt,this);this.destroy=d(this.destroy,this);this.evaluate=d(this.evaluate,this);this.setEditorHighlightMode=d(this.setEditorHighlightMode,this);this.focusCellBelow=d(this.focusCellBelow,this);this.focusCellAbove=d(this.focusCellAbove,this);this.blurInput=d(this.blurInput,this);this.focusInput=d(this.focusInput,this);this.changeInputFold=d(this.changeInputFold,
this);this.toggleInputFold=d(this.toggleInputFold,this);this.handleKeypress=d(this.handleKeypress,this);this.afterDomInsert=d(this.afterDomInsert,this);this.changeState=d(this.changeState,this);this.changeOutput=d(this.changeOutput,this);this.changeType=d(this.changeType,this);this.render=d(this.render,this);this.logev=d(this.logev,this);this.initialize=d(this.initialize,this);this.events=d(this.events,this);b.__super__.constructor.apply(this,arguments)}p(b,c);b.prototype.tagName="li";b.prototype.events=
function(){return{"keyup .spawn-above":"handleKeypress","dblclick .spawn-above":"spawnAbove","click .evaluate":"evaluate","click .delete":"destroy","click .toggle":"toggle","click .type":"toggle","click .fold-button":"toggleInputFold","dblclick .cell-output":"toggleInputFold",evaluate:"evaluate",toggle:"toggle","click .interrupt":"interrupt","keyup .cell-output":"handleKeypress","focus .cell-input":"focusInput","blur .cell-input":"blurInput"}};b.prototype.initialize=function(){this.template=_.template($("#cell-edit-template").html());
this.model.bind("change:state",this.changeState);this.model.bind("change:type",this.changeType);this.model.bind("change:output",this.changeOutput);this.model.bind("change:inputFold",this.changeInputFold);this.model.bind("destroy",this.remove);this.model.view=this;return this.editor=null};b.prototype.logev=function(a){return console.log("in ev",a)};b.prototype.render=function(){var a;null==this.editor&&(a=this.model.toJSON(),null==this.model.id&&(a.id=this.model.cid),$(this.el).html(this.template(a)),
this.spawn=this.$(".spawn-above"),this.input=this.$(".cell-input"),this.output=this.$(".cell-output"),this.inputContainer=this.$(".ace-container"),this.type=this.$(".type"),this.intButton=this.$(".interrupt"),this.evalButton=this.$(".evaluate"));return this.el};b.prototype.changeType=function(){this.setEditorHighlightMode();return this.type.html(this.model.get("type"))};b.prototype.changeOutput=function(){this.output.html(this.model.get("output"));if(a.mathjaxReady)return MathJax.Hub.Typeset(this.output[0])};
b.prototype.changeState=function(){switch(this.model.get("state")){case "evaluating":return this.output.html("..."),this.intButton.addClass("active"),this.evalButton.removeClass("active");case "dirty":return this.evalButton.addClass("active");case null:return this.intButton.removeClass("active")}};b.prototype.afterDomInsert=function(){var a,b,c,d=this;this.editor=ace.edit("input-"+(null!=this.model.id?this.model.id:this.model.cid));this.model.set({state:null});this.editor.getSession().setUseWrapMode(!0);
this.editor.renderer.setShowGutter(!1);this.editor.renderer.setHScrollBarAlwaysVisible(!1);this.editor.renderer.setShowPrintMargin(!1);this.editor.setHighlightActiveLine(!1);this.$(".ace_sb").css({display:"none"});b=this.model.get("input");a=Math.max(3-_.string.count(b,"\n"),0);console.log("crs");c=_.range(a);a=0;for(c=c.length;a<c;a++)b+="\n";this.editor.getSession().setValue(b);this.resizeEditor();this.editor.getSession().on("change",this.inputChange);this.setEditorHighlightMode();this.model.get("inputFold")&&
this.changeInputFold();this.editor.commands.addCommand({name:"evaluate",bindKey:{win:"Ctrl-E",mac:"Command-E",sender:"editor"},exec:function(){return d.evaluate()}});this.editor.commands.addCommand({name:"toggleMode",bindKey:{win:"Ctrl-M",mac:"Command-M",sender:"editor"},exec:function(){return d.toggle()}});this.editor.commands.addCommand({name:"interrupt",bindKey:{win:"Ctrl-C",mac:"Ctrl-C",sender:"editor"},exec:function(){return d.interrupt()}});this.editor.commands.addCommand({name:"golineup",bindKey:{win:"Up",
mac:"Up|Ctrl-P",sender:"editor"},exec:function(a,b){var c;c=d.$(".ace_cursor");f(c)||n(c);return 0===a.getSession().getSelection().getCursor().row?(d.spawn.focus(),d.rogueKeyup=!0):a.navigateUp(b.times)}});this.editor.commands.addCommand({name:"golinedown",bindKey:{win:"Down",mac:"Down",sender:"editor"},exec:function(a,b){var c,o;c=d.$(".ace_cursor");f(c)||m(c);o=a.getSession().getSelection().getCursor().row;c=d.editor.getSession().getDocument().getLength()-1;return o===c?(d.output.focus(),d.rogueKeyup=
!0):a.navigateDown(b.times)}});return this.editor.commands.addCommand({name:"backspace",bindKey:{win:"Backspace",mac:"Backspace",sender:"editor"},exec:function(a){a=a.getSession();return 1===a.getLength()&&""===a.getValue()?d.destroy():d.editor.remove("left")}})};b.prototype.handleKeypress=function(a){var b,c;if(!0===this.rogueKeyup)this.rogueKeyup=!1;else if(b=this.model.get("inputFold"),c=a.target.className,38===a.keyCode)switch(c){case "cell-output":return b?this.spawn.focus():this.focusInput("bottom");
case "spawn-above":return this.focusCellAbove()}else if(40===a.keyCode)switch(c){case "cell-output":return this.focusCellBelow();case "spawn-above":return b?this.output.focus():this.focusInput("top")}else if(13===a.keyCode)switch(c){case "spawn-above":return this.spawnAbove();case "cell-output":return this.toggleInputFold()}};b.prototype.toggleInputFold=function(){return this.model.toggleInputFold()};b.prototype.changeInputFold=function(){this.inputContainer.toggleClass("input-fold");this.$(".fold-button").toggleClass("input-fold");
return this.$("hr").toggleClass("input-fold")};b.prototype.focusInput=function(a){"top"===a?(this.editor.gotoLine(1),this.editor.focus()):"bottom"===a&&(this.editor.gotoLine(this.editor.getSession().getDocument().getLength()),this.editor.focus());if(null!=this.editor)return this.editor.setHighlightActiveLine(!0),this.$(".ace_cursor-layer").show()};b.prototype.blurInput=function(){if(null!=this.editor)return this.editor.setHighlightActiveLine(!1),this.$(".ace_cursor-layer").hide()};b.prototype.focusCellAbove=
function(){var a;a=this.model.collection.at(this.model.collection.indexOf(this.model)-1);if(null!=a)return a.view.output.focus()};b.prototype.focusCellBelow=function(){var a;a=this.model.collection.at(this.model.collection.indexOf(this.model)+1);return null!=a?a.view.spawn.focus():$("#spawner").focus()};b.prototype.setEditorHighlightMode=function(){var a;"javascript"===this.model.get("type")?a=require("ace/mode/javascript").Mode:"markdown"===this.model.get("type")&&(a=require("ace/mode/markdown").Mode);
if(null!=a)return this.editor.getSession().setMode(new a)};b.prototype.evaluate=function(){this.model.set({input:this.editor.getSession().getValue()});return this.model.evaluate()};b.prototype.destroy=function(){return this.model.destroy()};b.prototype.interrupt=function(){return this.model.interrupt()};b.prototype.remove=function(){return $(this.el).fadeOut("fast",$(this.el).remove)};b.prototype.spawnAbove=function(){return this.model.collection.createBefore(this.model)};b.prototype.toggle=function(){return this.model.toggleType()};
b.prototype.inputChange=function(){this.model.set({state:"dirty"});return this.resizeEditor()};b.prototype.resizeEditor=function(){var a,b;a=this.editor.renderer.$textLayer.getLineHeight();b=this.editor.getSession().getScreenLength();if(1===a)setTimeout(this.resizeEditor,200);else return this.$(".ace-container").height(20+a*b),this.editor.resize()};return b}(Backbone.View);i=function(c){function b(){this.mathjaxReady=d(this.mathjaxReady,this);this.loadFile=d(this.loadFile,this);this["new"]=d(this["new"],
this);this.addNbs=d(this.addNbs,this);this.addNb=d(this.addNb,this);this.render=d(this.render,this);this.initialize=d(this.initialize,this);b.__super__.constructor.apply(this,arguments)}p(b,c);b.prototype.className="app";b.prototype.events={"click #new-notebook-button":"new","change #load-file":"loadFile"};b.prototype.initialize=function(){this.template=_.template($("#index-template").html());$(".container").append(this.render());return this.addNbs()};b.prototype.render=function(){$(this.el).html(this.template());
return this.el};b.prototype.addNb=function(a){return $("#notebooks").append(this.nbtemplate(a.toJSON()))};b.prototype.addNbs=function(){this.nbtemplate=_.template($("#notebook-index-template").html());return a.notebooks.each(this.addNb)};b.prototype["new"]=function(){console.log("new");return a.router.navigate("new/",{trigger:!0})};b.prototype.loadFile=function(b){var c,b=b.target.files[0];c=new FileReader;c.onload=function(b){b=JSON.parse(b.target.result);b=l(b);return a.router.navigate(b.get("id")+
"/view/",{trigger:!0})};return c.readAsText(b)};b.prototype.mathjaxReady=function(){};return b}(Backbone.View);j=function(c){function b(){this.mathjaxReady=d(this.mathjaxReady,this);this.create=d(this.create,this);this.render=d(this.render,this);this.initialize=d(this.initialize,this);b.__super__.constructor.apply(this,arguments)}p(b,c);b.prototype.className="app";b.prototype.events={"click button":"create"};b.prototype.initialize=function(){this.template=_.template($("#new-notebook-form").html());
return $(".container").append(this.render())};b.prototype.render=function(){$(this.el).html(this.template());return this.el};b.prototype.create=function(){var b;b=a.notebooks.create({title:this.$("input").val()},{wait:!0});b.readyCells();b.cells.create({position:b.cells.posJump});return a.router.navigate(b.id+"/edit/",{trigger:!0})};b.prototype.mathjaxReady=function(){};return b}(Backbone.View);c=function(c){function b(){this["import"]=d(this["import"],this);this.loadUrl=d(this.loadUrl,this);this.index=
d(this.index,this);this["new"]=d(this["new"],this);this["delete"]=d(this["delete"],this);this.view=d(this.view,this);this.edit=d(this.edit,this);this.getNotebook=d(this.getNotebook,this);this.unmatched=d(this.unmatched,this);b.__super__.constructor.apply(this,arguments)}p(b,c);b.prototype.routes={":nb/edit/":"edit",":nb/view/":"view",":nb/delete/":"delete","load/*url":"loadUrl","new/":"new","import/*data/":"import","":"index"};b.prototype.unmatched=function(a){return console.log(a)};b.prototype.getNotebook=
function(b){b=a.notebooks.get(b);b.readyCells();a.nb=b;console.log("notebook loaded; id="+b.get("id"));return b};b.prototype.edit=function(b){a.app&&a.app.remove();console.log("activated edit route",b);b=this.getNotebook(b);a.app=new g({model:b});return r(b.get("title")+" (Editing)")};b.prototype.view=function(b){a.app&&a.app.remove();console.log("activated view route");b=this.getNotebook(b);r(b.get("title")+" (Viewing)");return a.app=new q({model:b})};b.prototype["delete"]=function(b){console.log("deleting nb",
b);confirm("You really want to delete that?")&&(b=this.getNotebook(b),b.cells.fetch({success:function(a){return a.each(function(a){console.log("destroy",a);return a.destroy()})}}),console.log("cells",b.cells.length),b.destroy(),console.log("deleted"));return a.router.navigate("",{trigger:!0})};b.prototype["new"]=function(){console.log("new view");a.app&&a.app.remove();return a.app=new j};b.prototype.index=function(){a.app&&(a.app.remove(),a.nb=null);console.log("index view");r("");return a.app=new i};
b.prototype.loadUrl=function(b){console.log("loading url");return $.getJSON(b,function(b){b=l(b);return a.router.navigate(b.get("id")+"/view/",{trigger:!0,replace:!0})})};b.prototype["import"]=function(b){b=JSON.parse(a.util.base64UrlDecode(b));b=l(b);return a.router.navigate(b.get("id")+"/view/",{trigger:!0,replace:!0})};return b}(Backbone.Router);r=function(a){return $("#title").html(a)};l=function(c){var b,d,e,f,g,h;d=c.cells;delete c.cells;c.title=c.title;try{a.notebooks.get(c.id)&&raise("duplicate");
console.log("no such nb",c.id);console.log("import notebook");e=a.notebooks.create(c);e.readyCells();f=function(a){return e.cells.create(a)};g=0;for(h=d.length;g<h;g++)b=d[g],f(b);return e}catch(i){return alert("Could not import notebook probably because it already exists.  try deleting"),console.log(i)}};e=function(){a.mathjaxReady=!0;return a.app.mathjaxReady()};$(document).ready(function(){console.log("creating app");a.notebooks=new a.Notebooks;a.notebooks.fetch();a.mathjaxReady=!1;a.router=new c;
Backbone.history.start();return MathJax.Hub.Register.StartupHook("End",e)})}).call(this);
